/*
                           --==Pixel Stats v1.0.5 (JS)==--
                              Scripting: Haloflooder
                                  Idea: CopherNeue

                                    Description
Counts the pixels and prints out the rgb value of all the colors along with the percentage!

                                GUI.xml requirement
Need to have these tags inside of <menu text="Scripts"> in the gui.xml file.

          <item command="RunScript" text="Image/Pixel statistics">
            <param name="filename" value="pixel_stats.js" />
          </item>

*/
var execTime = Date.now();

// Change this value to true if you want the script to run a tad bit faster
// If set to true, the console output won't be pretty
var speedMeUp = false;

// Change this value to false if you want the script to run a lot faster
// If set to false, the script won't show you the group of colors the pixels are in (red, orange, etc)
var showGroupedColors = true;

// Change these values to whatever you think is the minimum value to white
// example: I personally think anything that's lower than 16 (16,16,16) is black!
// Example: Well I think anything that's higher than 239 (239,239,239) is white!
var considerBlack = 16;
var considerWhite = 239;

// Shows more info about the code execution
var debug = false;


// Let the gibberish code begin!
var pc=app.pixelColor,img=app.activeImage,sel=app.activeSprite.selection,selected=!0,box=sel.bounds;0==box.width&&0==box.height&&(box=Rectangle(0,0,img.width,img.height),selected=!1);for(var colorData=[],pixelAmt=box.width*box.height,hsvData=[],hsvColors=["Red","Orange","Yellow","Yellow Green","Green","Green Cyan","Cyan","Blue Cyan","Blue","Blue Magenta","Magenta","Red Magenta"],justGray=0,justWhite=0,justBlack=0,i=0;i<hsvColors.length;i++)hsvData[i]=0;function rgb2hsv(e,o,a){e/=255,o/=255,a/=255;var r,c,s=Math.max(e,o,a),t=Math.min(e,o,a),l=s,i=s-t;if(c=0==s?0:i/s,s==t)r=0;else{switch(s){case e:r=(o-a)/i+(o<a?6:0);break;case o:r=(a-e)/i+2;break;case a:r=(e-o)/i+4}r/=6}return[255*r,255*c,255*l]}var charCodes=[];for(i=0;i<128;i++)charCodes[i]=5;function textWidth(e){var o=0;e+="";for(var a=0;a<e.length;a++)o+=charCodes[e.charCodeAt(a)];return o}function createSpacer(e,o){var a="";if(!speedMeUp){for(var r=textWidth(e),c=(textWidth(o)-r)/4,s=Math.floor(c),t=0;t<s;t++)a+=" ";c-s>=.5&&(a=":"+a)}return a}if(charCodes[32]=4,charCodes[33]=2,charCodes[34]=4,charCodes[35]=6,charCodes[36]=6,charCodes[37]=6,charCodes[38]=6,charCodes[39]=3,charCodes[40]=3,charCodes[41]=3,charCodes[42]=6,charCodes[43]=6,charCodes[44]=6,charCodes[45]=4,charCodes[46]=2,charCodes[47]=4,charCodes[49]=3,charCodes[58]=2,charCodes[59]=2,charCodes[60]=4,charCodes[62]=4,charCodes[63]=4,charCodes[64]=9,charCodes[73]=2,charCodes[74]=3,charCodes[77]=6,charCodes[79]=6,charCodes[81]=6,charCodes[84]=6,charCodes[86]=6,charCodes[87]=8,charCodes[88]=6,charCodes[89]=6,charCodes[91]=3,charCodes[92]=4,charCodes[93]=3,charCodes[94]=6,charCodes[95]=6,charCodes[96]=4,charCodes[102]=4,charCodes[105]=2,charCodes[106]=3,charCodes[108]=2,charCodes[109]=8,charCodes[114]=4,charCodes[115]=4,charCodes[116]=3,charCodes[119]=6,charCodes[120]=6,charCodes[123]=4,charCodes[124]=2,charCodes[125]=4,debug){console.log(" "),console.log("[DEBUG] Took script "+(Date.now()-execTime)+"ms to initialize"),console.log(" ");var initTime=Date.now()}for(var hueDivide=256/hsvColors.length,bigGroup=0,y=box.y;y<box.y+box.height;++y)for(var x=box.x;x<box.x+box.width;++x){var c=img.getPixel(x,y),r=pc.rgbaR(c),g=pc.rgbaG(c),b=pc.rgbaB(c),a=pc.rgbaA(c),cStr=r+","+g+","+b;if(0!=a&&(colorData[cStr]>=0?colorData[cStr]++:colorData[cStr]=1,showGroupedColors)){var h=rgb2hsv(r,g,b),calcHue=Math.round(h[0]/hueDivide)%hsvColors.length;r<=considerBlack&&g<=considerBlack&&b<=considerBlack?justBlack++:r>=considerWhite&&g>=considerWhite&&b>=considerWhite?justWhite++:r==g&&g==b&&r==b?justGray++:hsvData[calcHue]++}}if(debug){console.log(" "),console.log("[DEBUG] Took script "+(Date.now()-initTime)+"ms to gather the image data"),console.log(" ");var imageTime=Date.now()}var pixelStuff=[];for(var key in colorData)pixelStuff.push([key,colorData[key]]);if(pixelStuff.sort(function(e,o){return e=e[1],(o=o[1])-e}),debug){console.log(" "),console.log("[DEBUG] Took script "+(Date.now()-imageTime)+"ms to sort the color data"),console.log(" ");var sortTime=Date.now()}if(console.log("--==Image Statistics==--"),selected?console.log("Selection size: "+box.width+"x"+box.height):console.log("Image size: "+img.width+"x"+img.height),console.log("Total amount of pixels: "+pixelAmt),console.log("Total amount of colors: "+pixelStuff.length),console.log(" "),showGroupedColors){console.log("--==Grouped Color Statistics==--");for(i=0;i<hsvColors.length;i++){key=hsvColors[i];var value=hsvData[i],spacer1=createSpacer(key,"Blue Magenta");console.log(key+":"+spacer1+" "+value+"  ("+Math.round(value/pixelAmt*100*1e3)/1e3+"%)")}if(console.log("Black:"+createSpacer("Black:","Blue Magenta")+"  "+justBlack+"  ("+Math.round(justBlack/pixelAmt*100*1e3)/1e3+"%)"),console.log("White:"+createSpacer("White:","Blue Magenta")+"  "+justWhite+"  ("+Math.round(justWhite/pixelAmt*100*1e3)/1e3+"%)"),console.log("Gray:"+createSpacer("Gray:","Blue Magenta")+"  "+justGray),Math.round(justGray/pixelAmt*100*1e3),console.log(" "),debug){console.log(" "),console.log("[DEBUG] Took script "+(Date.now()-sortTime)+"ms to show the image and grouped color data"),console.log(" ");var groupTime=Date.now()}}console.log("--==Individual Color Statistics==--");for(i=0;i<pixelStuff.length;i++){key=pixelStuff[i][0],value=pixelStuff[i][1],spacer1=createSpacer(key,"000,000,000");var spacer2=createSpacer(value,pixelStuff[0][1]+"");console.log(key+":"+spacer1+"  "+value+spacer2+" pixels  ("+Math.round(value/pixelAmt*100*1e3)/1e3+"%)")}debug&&(console.log(" "),console.log("[DEBUG] Took script "+(Date.now()-groupTime)+"ms to show the grouped color data"),console.log(" "));var finalTime=Date.now()-execTime;console.log(" "),console.log("Took "+finalTime/1e3+" seconds to calculate");